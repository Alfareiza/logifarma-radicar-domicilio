{% load static %}

<header class="navbar pcoded-header navbar-expand-lg navbar-light">
  <div class="m-header">
    <a class="mobile-menu" id="mobile-collapse1" href="javascript:"><span></span></a>
    <a href="{% url 'index' %}" class="b-brand">
      <div class="b-bg">
        <!--<i class="feather icon-trending-up"></i>-->
        <img src="{% static 'img/ICONO-AZUL.png' %}" style="height: 1.5rem; width: 1.5rem">
      </div>
      <span class="b-title">Domicilios Logifarma</span>
    </a>
  </div>
  <a class="mobile-menu" id="mobile-header" href="javascript:">
    <i class="feather icon-more-horizontal"></i>
  </a>
  <div class="collapse navbar-collapse">
    <ul class="navbar-nav mr-auto">
      <li><a href="javascript:" class="full-screen" onclick="javascript:toggleFullScreen()">
        <i class="feather icon-maximize"></i></a>
      </li>
<!--      <li class="nav-item dropdown">-->
<!--        <a class="dropdown-toggle" href="javascript:" data-toggle="dropdown">Dropdown</a>-->
<!--        <ul class="dropdown-menu">-->
<!--          <li><a class="dropdown-item" href="javascript:">Action</a></li>-->
<!--          <li><a class="dropdown-item" href="javascript:">Another action</a></li>-->
<!--          <li><a class="dropdown-item" href="javascript:">Something else here</a></li>-->
<!--        </ul>-->
<!--      </li>-->

<!--  <li class="nav-item">-->
<!--        <div class="main-search">-->
<!--          <div class="input-group">-->
<!--            <input type="text" id="m-search" class="form-control" placeholder="Search . . .">-->
<!--            <a href="javascript:" class="input-group-append search-close">-->
<!--              <i class="feather icon-x input-group-text"></i>-->
<!--            </a>-->
<!--            <span class="input-group-append search-btn btn btn-primary">-->
<!--              <i class="feather icon-search input-group-text"></i>-->
<!--            </span>-->
<!--          </div>-->
<!--        </div>-->
<!--      </li>-->
    </ul>
    <ul class="navbar-nav ml-auto">
      <!-- Sart timer -->
        <li id="timer-container" style="padding-right:0px;color:#888">
      <!-- End timer -->
      <li>
       <div>
         <label>
          <input type="checkbox" id="autorefresh-switch" class="d-none">
          <i class="icon feather icon-refresh-cw auto-refresh" id="auto-refresh-indicator" data-toggle="tooltip"
             title="Actualiza la página cada 1 minuto"></i>
        </label>
       </div>
      </li>
      <li>
        <label>
          <i class="icon feather icon-sun" id="theme-indicator"></i>
          <input type="checkbox" id="theme-switch" class="d-none">
        </label>
      </li>
      <li>
        <div class="dropdown">
          <!--<a class="dropdown-toggle" href="javascript:" data-toggle="dropdown">
            <i class="icon feather icon-bell"></i>
          </a>-->
        <!-- Notification Menú -->
         <!-- <div class="dropdown-menu dropdown-menu-right notification">
            <div class="noti-head">
              <h6 class="d-inline-block m-b-0">Notifications</h6>
               <div class="float-right">
                <a href="javascript:" class="m-r-10">mark as read</a>
                <a href="javascript:">clear all</a>
              </div>
            </div>
            <ul class="noti-body">
              <li class="n-title">
                <p class="m-b-0">NEW</p>
              </li>
              <li class="notification">
                <div class="media">
                  <img class="img-radius" src="{% static 'assets/images/user/avatar-1.jpg' %}" alt="Generic placeholder image">
                  <div class="media-body">
                    <p><strong>{{ user.first_name }}</strong><span class="n-time text-muted"><i
                          class="icon feather icon-clock m-r-10"></i>30 min</span></p>
                    <p>New ticket Added</p>
                  </div>
                </div>
              </li>
              <li class="n-title">
                <p class="m-b-0">EARLIER</p>
              </li>
              <li class="notification">
                <div class="media">
                  <img class="img-radius" src="{% static 'assets/images/user/avatar-2.jpg' %}" alt="Generic placeholder image">
                  <div class="media-body">
                    <p><strong>Joseph William</strong><span class="n-time text-muted"><i
                          class="icon feather icon-clock m-r-10"></i>30 min</span></p>
                    <p>Prchace New Theme and make payment</p>
                  </div>
                </div>
              </li>
              <li class="notification">
                <div class="media">
                  <img class="img-radius" src="{% static 'assets/images/user/avatar-3.jpg' %}" alt="Generic placeholder image">
                  <div class="media-body">
                    <p><strong>Sara Soudein</strong><span class="n-time text-muted"><i
                          class="icon feather icon-clock m-r-10"></i>30 min</span></p>
                    <p>currently login</p>
                  </div>
                </div>
              </li>
            </ul>
            <div class="noti-footer">
              <a href="javascript:">show all</a>
            </div>
          </div>-->
          <!-- END Notification Menú -->
        </div>
      </li>
      <li>
        <div class="dropdown drp-user">
          <a href="javascript:" class="dropdown-toggle" data-toggle="dropdown">
            <i class="icon feather icon-settings"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right profile-notification">
            <div class="pro-head">
              <img src="{% static 'assets/images/user/avatar-2.jpg' %}" class="img-radius" alt="User-Profile-Image">
              <span>{{ user.first_name|default:"Hola"|title }}</span>
              {% if request.user.is_authenticated %}
                <a href="{% url 'logout' %}" class="dud-logout" title="Logout">
                  <i class="feather icon-log-out"></i>
                </a>
              {% endif %}
            </div>
          <!--<ul class="pro-body">
              <li><a href="javascript;" class="dropdown-item"><i class="feather icon-settings"></i>
                  Settings</a></li>
              <li><a href="javascript;" class="dropdown-item"><i class="feather icon-user"></i>
                  Profile</a></li>
              <li><a href="javascript;" class="dropdown-item"><i class="feather icon-mail"></i> My
                  Messages</a></li>
              <li><a href="javascript;" class="dropdown-item"><i class="feather icon-lock"></i> Lock
                  Screen</a></li>
              {% if request.user.is_authenticated %}
              <li>
              {% comment %}
                {% if request.user.is_superuser %}
                <a href="{% url 'admin:password_change' %}" class="dropdown-item">
                {% else %}
                <a href="{% url 'password_change' %}" class="dropdown-item">
                {% endif %}
              {% endcomment %}
                  <i class="feather icon-edit"></i>Change Password
                </a>
              </li>
              {% endif %}
            </ul>-->
          </div>
        </div>
      </li>
    </ul>
  </div>
</header>
<script>
    let refreshInterval;
    let countdownInterval;
    let countdownValue = 60; // Start from 60 seconds

    const autoRefreshSwitch = document.getElementById('autorefresh-switch');
    const autoRefreshIndicator = document.getElementById('auto-refresh-indicator');
    const timerContainer = document.getElementById('timer-container');

    console.log('opa0')

    // Check the saved state in localStorage when the page loads
    window.onload = function() {
        const isAutoRefreshEnabled = localStorage.getItem('isAutoRefreshEnabled') === 'true';

        // Set checkbox and auto-refresh state based on stored value
        autoRefreshSwitch.checked = isAutoRefreshEnabled;

        if (isAutoRefreshEnabled) {
            enableAutoRefresh();
        } else {
            disableAutoRefresh();
        }
    };

    // Event listener for checkbox change
    autoRefreshSwitch.addEventListener('change', function () {
        if (this.checked) {
            // Enable auto-refresh
            enableAutoRefresh();
            console.log('Auto actualización activada')
        } else {
            // Disable auto-refresh
            disableAutoRefresh();
            console.log('Auto actualización desactivada')
        }

        // Save the state in localStorage
        localStorage.setItem('isAutoRefreshEnabled', this.checked);
    });

    function enableAutoRefresh() {
        // Start auto-refresh interval
        refreshInterval = setInterval(function () {
            location.reload();
        }, 60000); // Refresh every 60000 milliseconds (1 minute)

        // Remove the "disabled-refresh" class when enabling
        autoRefreshIndicator.classList.remove('disabled-refresh');

         showTimer();
         startCountdown();

    }

    function disableAutoRefresh() {
        // Clear auto-refresh interval
        clearInterval(refreshInterval);

        // Add the "disabled-refresh" class to change styles
        autoRefreshIndicator.classList.add('disabled-refresh');

         // Hide the timer and stop countdown
        hideTimer();
        stopCountdown();
    }

     function showTimer() {
        // Render the timer HTML
        timerContainer.innerHTML = `<p id="countdown">${countdownValue}</p>`;
    }

    function hideTimer() {
        // Clear the timer HTML
        timerContainer.innerHTML = '';
    }

    function startCountdown() {
        countdownValue = 60; // Reset the countdown
        countdownInterval = setInterval(function() {
            countdownValue--;
            document.getElementById('countdown').textContent = countdownValue;

            // If countdown reaches 0, reset to 60 for the next interval
            if (countdownValue <= 0) {
                countdownValue = 60;
            }
        }, 1000); // Update every second
    }

    function stopCountdown() {
        clearInterval(countdownInterval); // Stop the countdown
    }
</script>
